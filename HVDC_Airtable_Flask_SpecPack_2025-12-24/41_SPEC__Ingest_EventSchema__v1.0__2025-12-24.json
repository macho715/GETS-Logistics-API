{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "HVDC Ingest Event Schema v1.0",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "batchId",
    "sourceSystem",
    "timezone",
    "events"
  ],
  "properties": {
    "batchId": {
      "type": "string",
      "description": "UUID or deterministic batch key"
    },
    "sourceSystem": {
      "type": "string",
      "description": "eDAS|SAP|EMAIL|RPA|EXCEL|MANUAL|API"
    },
    "timezone": {
      "type": "string",
      "const": "Asia/Dubai"
    },
    "receivedAt": {
      "type": "string",
      "description": "ISO 8601 datetime",
      "nullable": true
    },
    "events": {
      "type": "array",
      "minItems": 1,
      "maxItems": 500,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "eventKey",
          "timestamp",
          "shptNo",
          "entityType",
          "toStatus"
        ],
        "properties": {
          "eventKey": {
            "type": "string",
            "description": "Idempotency key (unique per event)"
          },
          "timestamp": {
            "type": "string",
            "description": "ISO 8601 datetime"
          },
          "shptNo": {
            "type": "string",
            "description": "Shipment No. e.g., SCT-0143"
          },
          "entityType": {
            "type": "string",
            "enum": [
              "SHIPMENT",
              "DOCUMENT",
              "APPROVAL",
              "ACTION",
              "DATA_QUALITY"
            ]
          },
          "entityRef": {
            "type": "object",
            "nullable": true,
            "description": "Optional entity locator",
            "properties": {
              "docType": {
                "type": "string",
                "nullable": true
              },
              "approvalType": {
                "type": "string",
                "nullable": true
              },
              "actionKey": {
                "type": "string",
                "nullable": true
              }
            },
            "additionalProperties": false
          },
          "fromStatus": {
            "type": "string",
            "nullable": true
          },
          "toStatus": {
            "type": "string"
          },
          "bottleneckCode": {
            "type": "string",
            "nullable": true
          },
          "riskLevel": {
            "type": "string",
            "enum": [
              "LOW",
              "MEDIUM",
              "HIGH",
              "CRITICAL"
            ],
            "nullable": true
          },
          "actor": {
            "type": "string",
            "nullable": true
          },
          "owner": {
            "type": "string",
            "nullable": true
          },
          "dueAt": {
            "type": "string",
            "nullable": true
          },
          "evidenceIds": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          },
          "rawPayload": {
            "type": [
              "object",
              "string",
              "null"
            ],
            "description": "Raw JSON object or JSON string",
            "nullable": true
          }
        }
      }
    }
  }
}