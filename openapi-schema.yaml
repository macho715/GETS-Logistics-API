openapi: 3.1.0
info:
  title: GETS Logistics API
  version: 1.4.0
  description: |
    HVDC Project Logistics API (SpecPack v1.0)

    Provides operational status packets for shipment document tracking,
    approval management, bottleneck analysis, and KPI monitoring.

    Timezone: Asia/Dubai (+04:00)
    Data Source: Airtable (Real-time)

servers:
  - url: https://gets-m775824u0-chas-projects-08028e73.vercel.app
    description: Production server (Vercel) - SpecPack v1.0

paths:
  /document/status/{shptNo}:
    get:
      summary: Get document status packet
      operationId: getDocumentStatus
      description: |
        Returns operational status packet for a shipment including:
        - Document status (BOE, DO, COO, HBL, CIPL)
        - Bottleneck analysis (code, since, risk level)
        - Next action (description, owner, due date)
        - Evidence references
        - Data lag metrics
      parameters:
        - name: shptNo
          in: path
          required: true
          description: Shipment number (e.g., SCT-0143)
          schema:
            type: string
          example: SCT-0143
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  shptNo:
                    type: string
                  doc:
                    type: object
                    properties:
                      boeStatus:
                        type: string
                      doStatus:
                        type: string
                      cooStatus:
                        type: string
                      hblStatus:
                        type: string
                      ciplStatus:
                        type: string
                  bottleneck:
                    type: object
                    properties:
                      code:
                        type: string
                      since:
                        type: string
                      riskLevel:
                        type: string
                  action:
                    type: object
                    properties:
                      nextAction:
                        type: string
                      owner:
                        type: string
                      dueAt:
                        type: string
                  evidence:
                    type: array
                    items:
                      type: object
                  meta:
                    type: object
                    properties:
                      dataLagMinutes:
                        type: integer
                      lastUpdated:
                        type: string
              example:
                shptNo: "SCT-0143"
                doc:
                  boeStatus: "SUBMITTED"
                  doStatus: "NOT_STARTED"
                  cooStatus: "PENDING"
                  hblStatus: "READY"
                  ciplStatus: "VALID"
                bottleneck:
                  code: "FANR_PENDING"
                  since: "2025-12-24T09:00:00+04:00"
                  riskLevel: "HIGH"
                action:
                  nextAction: "FANR 승인 상태 확인 및 가속 요청"
                  owner: "Customs/Compliance"
                  dueAt: "2025-12-25T12:00:00+04:00"
                evidence: []
                meta:
                  dataLagMinutes: 900
                  lastUpdated: "2025-12-25T00:00:00+04:00"
        '404':
          description: Shipment not found

  /approval/status/{shptNo}:
    get:
      summary: Get approval status
      operationId: getApprovalStatus
      description: |
        Returns approval tracking information for a shipment including:
        - Approval type (FANR, MOEI, MOIAT, etc.)
        - Status (SUBMITTED, PENDING, APPROVED, etc.)
        - Timeline (submitted, due dates)
        - Owner information
        - Evidence references
      parameters:
        - name: shptNo
          in: path
          required: true
          description: Shipment number
          schema:
            type: string
          example: SCT-0143
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  shptNo:
                    type: string
                  approvals:
                    type: array
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                        status:
                          type: string
                        submittedAt:
                          type: string
                        dueAt:
                          type: string
                        owner:
                          type: string
                        evidenceIds:
                          type: array
                          items:
                            type: string
                  lastUpdated:
                    type: string

  /document/events/{shptNo}:
    get:
      summary: Get event history
      operationId: getDocumentEvents
      description: |
        Returns append-only event ledger for a shipment.
        Useful for audit trail and timeline analysis.
      parameters:
        - name: shptNo
          in: path
          required: true
          description: Shipment number
          schema:
            type: string
          example: SCT-0143
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  shptNo:
                    type: string
                  events:
                    type: array
                    items:
                      type: object
                      properties:
                        eventId:
                          type: integer
                        timestamp:
                          type: string
                        entityType:
                          type: string
                        fromStatus:
                          type: string
                        toStatus:
                          type: string
                        bottleneckCode:
                          type: string
                        actor:
                          type: string
                        sourceSystem:
                          type: string
                  totalEvents:
                    type: integer
                  lastUpdated:
                    type: string

  /status/summary:
    get:
      summary: Get overall KPI summary
      operationId: getStatusSummary
      description: |
        Returns aggregated KPI metrics including:
        - Total shipment count
        - Document completion rates
        - Risk distribution
        - Top bottlenecks
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  dataSource:
                    type: string
                  totalShipments:
                    type: integer
                  boeRate:
                    type: number
                  doRate:
                    type: number
                  cooRate:
                    type: number
                  hblRate:
                    type: number
                  ciplRate:
                    type: number
                  riskSummary:
                    type: object
                    properties:
                      LOW:
                        type: integer
                      MEDIUM:
                        type: integer
                      HIGH:
                        type: integer
                      CRITICAL:
                        type: integer
                  topBottlenecks:
                    type: array
                    items:
                      type: object
                      properties:
                        code:
                          type: string
                        count:
                          type: integer
                  lastUpdated:
                    type: string

  /bottleneck/summary:
    get:
      summary: Get bottleneck analysis
      operationId: getBottleneckSummary
      description: |
        Returns detailed bottleneck analysis including:
        - Bottleneck counts by code
        - Detailed shipment lists per bottleneck
        - Aging distribution (24h, 48h, 72h buckets)
        - Risk levels
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  bottlenecks:
                    type: object
                  details:
                    type: object
                  agingDistribution:
                    type: object
                    properties:
                      under_24h:
                        type: integer
                      24h_to_48h:
                        type: integer
                      48h_to_72h:
                        type: integer
                      over_72h:
                        type: integer
                  lastUpdated:
                    type: string

# No authentication required - API is public
